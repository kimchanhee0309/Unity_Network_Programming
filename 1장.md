# 온라인 게임을 만들자

<details>
<summary>1.1 온라인 게임 제작의 실제</summary>
<div markdown="1">       

#### 온라인 게임은 쉽게 만들 수 있다
* 기본 처리는 정보를 보내고, 받고 반영하는 것
* 통신 기술 설명서에는 상대방 캐릭터를 움직이는 방법이나 아이템 획득 시간의 동기 방식은 설명하지 않음
* 통신의 기초 기술과 온라인 게임을 만드는 기술 사이에는 큰 차이가 있음
  * 이 차이를 메우는 것이 온라인 특유의 노하우와 테크닉!

#### 비극은 현장에서 일어난다
> 오프라인 게임을 완성한 다음 통신 기능만 추가하면 온라인 게임이 될 거야.
* But, 통신은 범용적인 시스템을 하나 만들어 두고 여러 게임에서 재활용할 수 있는 구조가 아님

#### 오프라인 모드와 온라인 모드는 다르다
* 통신(네트워크)란? 단순히 **데이터를 주고받는 처리**
* 예시(키 입력 동기 구조)
  * 키 입력 정보를 서로 주고 받는 ‘키 입력 동기’ 구조는 적은 인원 사이의 통신에 적합함
  * 실시간 액션 MO(Multiplayer Online, 많은 인원이 플레이하는 온라인 게임)에 적용한다면?
    * 모든 사람의 키 입력이 끝날 때까지 자신의 캐릭터를 조종할 수 없음
    * 모든 단말이 반드시 같은 프레임을 처리하는 것이 아니기 때문임
    * 통신 환경 및 상황에 따라 한 대라도 처리가 지연되면 모든 단말에서 처리가 지연됨
    * 즉, 키 입력 동기 구조는 실시간 액션 MO 게임에는 적합하지 않은 통신 방식이라는 점!
* 즉 게임마다 통신하는 데이터도 다르고 통신하는 타이밍도 다름
* 통신 모듈은 옵션처럼 나중에 기능을 추가할 수 있는 것이 아닌, 게임 자체에 깊이 관여하는 모듈임

#### 데이터는 곧바로 전달되지 않는다
* `통신 지연` or `지연` : 데이터를 전송해서 상대에게 전달되기까지 걸리는 시간
* 대부분의 게임은 <span style="color:red">**60FPS(Frame Per Second, 1초간 프레임 수)**</span> 로 동작함
  * 1프레임 당 처리 시간 : 1.000(ms)/60(프레임) = 16.6666….(ms/프레임)
* 통신 데이터를 송수신하는 환경에서는 통신 처리와 게임의 프레임 처리를 동기화하지 않음
  * So, 통신 지연이 16.6666ms 이하로 상대에게 전달되어도 같은 프레임에서 처리된다고 단정할 수 없음
* 통신으로 정보를 주고받을 때는 반드시 지연이 발생함
  * **반드시 정보를 송신한 쪽과 수신한 쪽의 같은 프레임에서 처리되지 않는다**는 사실을 전데로 각각의 단말에서 처리해야 함

#### 오프라인 게임과 온라인 게임의 게임 디자인 차이
* 오프라인 격투 게임
  * 1프레임 단위의 혹독한 타이밍으로 플레이하는 게임 디자인을 채용함
* 온라인 격투 게임
  * 대부분 키 입력을 동기화하여 단말 두 대가 같은 상태에서 처리하는 방식으로 통신함
  * So, 키 입력 동기 방식에서는 양쪽 데이터가 모두 갖춰지지 않으면 처리할 수 없음
    * 이를 막고자 **입력을 지연**시키고 **데이터가 갖추어지기를 기다렸다가 반영하는 기법**을 도입
    * But, 키 입력이 게임에 반영되는 시점이 늦어진다는 문제가 발생함
    * 통신 지연이 길어지면 키 입력이 반영되는 것도 그만큼 늦어짐
* So, 게임 디자인이 달라지므로 오프라인 모드와 온라인 모드는 별개의 게임임

#### 비극에서 벗어나려면
* 온라인 게임을 만들 때는 통신 지연과 같이 소프트웨어 기술만으로 해결할 수 없는 문제가 있다는 사실을 염두에 두고 게임을 디자인(기획)해야 함
* 통신 지연이 없는 오프라인 버전과 통신 지연이 있는 온라인 버전 모두에 통용되는 게임 디자인을 제작 초기부터 생각해야 함
</div>
</details>

___

<details>
<summary>1.2 온라인 게임 제작의 기초</summary>
<div markdown="1">       

#### 온라인 게임의 통신 방식
* **동기 방식**
  * 통신할 단말 사이에서 데이터를 주고받아 **각 단말의 처리 결과가 완전히 일치**하는 통신 방식
  * 필요한 정보를 서로 송수신하여 각 단말의 상태가 똑같음(지연되더라도 똑같아야 함!)
  * 상태를 완전히 일치시키는 동기 방식의 종류
    * **턴 동기**는 턴마다 상태가 일치하는 동기 방식임
    * **키 입력 동기**는 컨트롤러의 입력 정보를 서로 전송하여, 같은 프레임의 데이터를 처리함으로써 단말을 같은 상태로 동작시킬 수 있는 동기 방식임
* **비동기 방식**
  * 꼭 필요한 최소 정보만으로 각 단말의 상태를 일치시키는 방식
  * 동기 방식과 달리 **단말 간의 처리가 완전히 일치하지는 않음**
  * 예시(MMO에서 키 입력 동기를 사용한 경우)
    * 모든 플레이어의 정보를 수신한 다음에 동기화하면 데이터가 모일 때까지 긴 시간을 기다려야 함
    * 기다리는 동안에 게임이 멈춰 있는 상태이므로 적절한 게임 플레이가 불가능함
    * 이런 경우 비동기 방식을 사용하면 멈추는 일 없이 게임을 진행할 수 있음
  * 단, **자신의 단말과 상대방 단말의 일관성을 잃어버린다는 문제점**이 있음
    * 통신 상대방과 일관성을 유지할 방법을 마련해야 함!

#### 온라인 게임의 게임 디자인
* 온라인 게임의 게임 디자인을 생각할 때 고려해야 할 통신의 제약
  * **통신 지연**
    * 서로의 데이터가 전달되기까지 각각의 단말에서 어떻게 게임을 진행하면 좋을지 생각함
    * 게임 중에 항상 발생하므로 온라인 게임을 만들 때 플레이어가 통신 지연을 느낄 수 없는 게임 디자인(기획)이 필요함
  * **데이터 소실**
    * 데이터 소실 시 데이터를 어떻게 재송신할지, 재송신될 때까지 게임은 어떻게 처리할지 등을 고려하면서 사양을 결정해야 함
  * **회선 끊김**
    * 남은 플레이어로 게임을 계속할지 끊어진 플레이어의 게임 결과를 어떻게 다룰지 등을 생각할 필요가 있음

#### 데이터의 흐름을 경과 시간으로 생각하자(책 그림 보고 이해하기)

#### 일대인 대전은 네 명이 싸운다?(책 그림 보고 이해하기)

#### 오류도 사양의 하나
* 온라인 게임에서는 데이터가 예정대로 전달되지 않거나 회선이 끊기는 오류가 발생하기도 함
  * But, 사양에 따라서는 이 상태에서도 정상적으로 게임을 계속할 수 있어야 함
  * 즉, 통신 프로그램은 오류 발생이 당연하다는 것을 전제로 만들어져야 함
* 통신 프로그램에서는 예상할 수 있는 오류는 정상 동작보다 먼저 처리해야 함
</div>
</details>

___

<details>
<summary>1.3 이 책에 대해서</summary>
<div markdown="1">       

#### 용어 설명
* **단말(터미널)** : 컴퓨터, 휴대전화 등 게임을 플레이하는 기기
* **플레이어** : 단말로 게임을 플레이하는 사람
* **캐릭터** : 플레이어가 게임 세계에서 조종하는 주인공
* **로컬 단말** : 자신이 플레이하는(조종하는) 단말
* **리모트 단말** : 통신 상대의 단말
* **로컬 캐릭터** : 로컬 단말에서 조종하는 자신의 캐릭터
* **리모트 캐릭터** : 리모트 단말에서 통신 상대방이 조종하는 로컬 단말의 캐릭터
* **게임 서버** : 게임 플레이 중에 단말과 접속해 게임 데이터를 일원적으로 관리하거나 호스트-게스트의 데이터를 중계하는 서버
* **게임 클라이언트** : 게임 서버와 통신해서 게임을 플레이하는 단말
* **호스트** : 게임을 진행하고 데이터를 관리하는 단말
* **게스트** : 게임 진행 정보를 호스트에서 받아서 게임을 진행하는 단말
* **게임 애플리케이션** : 게임을 움직이는 프로그램 전체
* **게임 처리** : 통신, 그래픽 등의 시스템 처리를 제외한 게임을 플레이하기 위한 처리를 가리킴
</div>
</details>
